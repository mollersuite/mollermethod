--[[<meta name='robots' content='noindex,nofollow' /><link rel="stylesheet" href="style.css"><main>
	<h1>mollermethod<sup><img src="icon.png" title="wat da dog doin" height="16"></sup></h1>
	<pre>loadstring (game:HttpGet "mthd.ml") {

}</pre>
<h2>features (green = done, red = working on/planned, mollermethod will only launch when all are green)</h2>
<ul>
	<li class="done">when ran in some script builders, or a game you own, you get special serversided features</li>
	<li class="fail">a command line interface, named Bracket. press <code>[</code> to toggle it.</li>
	<li class="done">moller sidekick: mollermethod automatically suggests scripts depending on what you're doing in the game.
	<ul>
	<li>example: you build a glue-powered flying machine grinder in BABFT, and moller sidekick will suggest an autofarm</li>
	</ul>
	</li>
	<li class="fail">A plugin API, for the games we don't support. (i got no idea how this is gonna look)</li>
	<li class="fail">at least like 10 games (just put this here so i can track it)</li>
	<li class="fail">can join ropro codes, rogold codes, and DomainX codes (until mlemix sees this and changes the backend)</li>
</ul>
<h2>Compare</h2>
<table>
<thead>
	<tr>
		<th>Feature</th>
		<th>mollermethod</th>
		<th>Sirius</th>
	</tr>
</thead>
<tr>
	<td>Admin</td>
	<td>Bracket (<abbr title="Console window appears when you launch Bracket standalone. Zero instances are created. (Only when standalone, since mollermethod has a GUI anyway)">external gui</abbr> when <abbr title="When the admin is ran by itself">standalone</abbr>)</td>
	<td>COMMANDER (<abbr title="A GUI is created when you launch Commander standalone. This takes time and may be detectable if the game can sandbox escape.">internal gui</abbr> when <abbr title="When the admin is ran by itself">standalone</abbr>)</td>
</tr>
<tr>
	<td>Site backend</td>
	<td>Static site</td>
	<td>PHP</td>
</tr>
<tr>
	<td>Buisness model</td>
	<td>None</td>
	<td>Linkvertise + Premium</td>
</tr>
<tr>
	<td>script auto-suggest</td>
	<td>behavior-based<br>(asks if you want to run features of a script when it<br>thinks you want to do them)</td>
	<td>game-based<br>(asks you if you want to run a script gui on launch when a script<br>supports your game)</td>
</tr>
<tr>
	<td>Cloud scripts</td>
	<td>Luau.ml (in-house), ScriptBlox (reverse engineered their website)</td>
	<td>ScriptBlox (officially partnered)</td>
</tr>
<tr>
	<td>UI Library</td>
	<td>None, use plugins instead</td>
	<td>ShlexLib, prints to console on launch LOL</td>
</tr>
<tr>
	<td>Supported join codes</td>
	<td>RoPro, RoGold, IY, Sirius</td>
	<td>Sirius (premium only)</td>
</tr>
<tr>
	<td>Server-side integration</td>
	<td>On games you own and some <abbr title="Script Builders">SBs</abbr></td>
	<td>Premium only, supports actual serversides</td>
</tr>
<tr>
	<td><abbr title="How many times has the script been redone from scratch?">Refactors</abbr></td>
	<td>4 (v2 "mthd", v3 "m¬≤", v4 "Mollybdenite", v5 "trendsetter")</td>
	<td>3 (Domain2, DomainX, & Sirius)</td>
</tr>
</table>
<small>üïØÔ∏è Dedicated to Molly</small>
</main><template hidden id=source>--]]

-- TODO: Adopt LuaQuack's code style

local CONFIG = ... or { Debug = true } -- in prod it's gonna only be ran with varargs

local API = CONFIG.API or loadstring(game:HttpGetAsync('https://mthd.ml/api'))'mollermethod API'

local ContentProvider = game:GetService('ContentProvider')
local Tween = game:GetService('TweenService')
local Players = game:GetService('Players')
local GuiService = game:GetService('GuiService')
local Debris = game:GetService('Debris')
local Player = Players.LocalPlayer

local GUI = Instance.new('ScreenGui')
GUI.Name = game:GetService('HttpService'):GenerateGUID()
GUI.IgnoreGuiInset = true
GUI.ResetOnSpawn = false
GUI.DisplayOrder = (2 ^ 31) - 1
API.parent(GUI)

-- photos of a dead dog
local ids = {
	'rbxassetid://7037264869', -- the infamous images/zzz
	'rbxassetid://7037156897', -- moller circular
	'rbxassetid://7043731194', -- molly mug
	'rbxassetid://7037269561', -- devil dog (will kill you if you do not repost)
	'rbxassetid://7037272153', -- mollerOS logo
	'rbxassetid://7037339934', -- molge
	'rbxassetid://7037356929', -- idk what this is but its funny
	'rbxassetid://7044042331', -- mollersuite/moller hub logo before it got turned monocolor
	'rbxassetid://7044088926', -- seconds before "bragle" was taken
	'rbxassetid://7046289590' -- she wants your food
}

local remote
function serverside()
	local remotename = game:GetService('HttpService'):GenerateGUID(false)
	local Code =
		string.format(
			[[
			pcall(function ()
				script.Parent = nil
			end)
			local nativeloadstring = pcall(loadstring, '--')
			local remote = Instance.new('RemoteFunction', game:GetService('ProximityPromptService'))
			remote.Name = %q
			local user = %i
			function func (player, action, code)
				if player.UserId ~= user then
					print(player.UserId, 'tried to use it, but the owner is', user)
					return
				end
				if action == 'respawn' then
					player:LoadCharacter()
				end
				if action == 'run' then
					task.defer(pcall, function ()
						local run = nativeloadstring and loadstring or require(8194576728)
						run(code)()
					end)
				end
			end
			remote.OnServerInvoke = func
		]],
			remotename,
			Player.UserId
		)
	local PlayerGui = Player:FindFirstChildOfClass('PlayerGui')

	if game.PlaceId == 1075564225 then -- Script Showcase
		game:GetService('ReplicatedStorage').ScriptRemotes.LoadS:FireServer('Server', Code)
	end

	if game.PlaceId == 7061215094 then -- Madness Mainia! Script Builder
		PlayerGui.Executor.Remote:FireServer(Code)
	end

	if game.PlaceId == 6948453065 then -- require script
		PlayerGui:FindFirstChild('SS Executor').Frame.Exe.RemoteEvent:FireServer(Code)
	end

	-- todo: detect adonis and then use command bar to do :s

	game:GetService('LogService'):ExecuteScript(Code) -- Developer Console
	return game:GetService('ProximityPromptService'):WaitForChild(remotename, 1)
end

local tags = {}

local plugins = {}

Players.PlayerAdded:Connect(function(player)
	tags[player.UserId] = setmetatable(
		{},
		{ __newindex = function(tbl, index, name)
			if CONFIG.Debug then
				print('new tag for', player, name)
			end
			return rawset(tbl, index, name)
		end }
	)
	for _, plugin in pairs(plugins) do
		if plugin.Tags then
			task.defer(plugin.Tags, player, tags[player.UserId])
		end
	end
end)

function preload(finish)
	local time = os.clock()

	-- loading code here...
	ContentProvider:PreloadAsync({ 'rbxassetid://8192419115', 'rbxassetid://8370988437' })

	remote = serverside() -- takes 1 second if the game isnt an sb, instant otherwise
	for _, url in pairs({ 'https://mthd.ml/plugins/tags.lua' }) do
		local successful = pcall(function()
			local plugin = loadstring(game:HttpGetAsync(url), url)({ remote = remote }, API)

			table.insert(plugins, plugin)
			if CONFIG.Debug then
				print('[mollermethod] loaded plugin', plugin.Name, '(' .. url .. ')')
			end
		end)

		if not successful and CONFIG.Debug then
			warn('[mollermethod] failed to load plugin', url)
		end
	end

	for _, player in pairs(Players:GetPlayers()) do
		tags[player.UserId] = setmetatable(
			{},
			{ __newindex = function(tbl, index, name)
				if CONFIG.Debug then
					print('new tag for', player, name)
				end
				return rawset(tbl, index, name)
			end }
		)
		for _, plugin in pairs(plugins) do
			if plugin.Tags then
				task.defer(plugin.Tags, player, tags[player.UserId])
			end
		end
	end

	local finished = os.clock()
	if CONFIG.Debug then
		print('[mollermethod] Loaded in ' .. (finished - time) .. ' seconds.')
	end

	local border = Instance.new('Frame', GUI)
	Debris:AddItem(border, 1)
	border.Size = UDim2.fromScale(1, 1)
	border.AnchorPoint = Vector2.new(0.5, 0.5)
	border.Position = UDim2.fromScale(0.5, 0.5)
	border.BackgroundTransparency = 1
	local stroke = Instance.new('UIStroke', border)
	stroke.Thickness = 15
	stroke.Color = Color3.new(1, 1, 1)
	Tween:Create(
		border,
		TweenInfo.new(.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out, 0, true),
		{ Size = UDim2.new(1, -10, 1, -10) }
	):Play()
	if (finished - time) < 1 then
		task.wait(1 - (finished - time))
	end

	finish()
end

local quotes = {
	'"https://tenor.com/view/ŸáŸÖŸÖ-gif-21570043" - Bongo, 2022, after I told him Molly was put down', -- the most fucked up quote of them all
	'"wait no dont said no furry porn" - Bongo, 2022 (right before Amourousity sent furry porn)',
	'"i am going to FARD" - Amourousity, 2022',
	'"I\'d get report bottled [sic]" - Jack, 2022',
	'"I like snake venom is because of its UI/UX effects [...] I dont have anywehre [sic] near the skill to recreate it" - Sp3ct3r3, 2022',
	'"i forgot how to sleep" - Mr. Hase, 2022',
	'"bruh im having so much trouble with ca-tay ui" - Bongo, 2022',
	'":(" - Mr. Hase, 2021',
	'"I know how to bypass https encryption" - tact, 2022',
	'"trollsmile [not] winning" - Amourousity, 2021',
	'"[I want you to make a] grab knife script but its a meme knife for mobile and pc" - k9#7062, 2021',
	'"WHAT THE FUCK IS MOLY MOLER [sic] DOING" - DeadBoris, 2021',
	'"i fuking hat you ashole ill fuck find you [...] tis yor fault" - Vexaria, 2021',
	'"this is why you dont give people stuff that actually works and isnt bad" - Charlie, 2021',
	'"Well listen and listen well, me and Auxnos partnered and fixed the animations, lights, and fixed the guns." - mongrio, 2021',
	[["I'ma hack u y'all" - cash_youtwin, 2020]]
}

function intro()
	local loading = true

	task.defer(preload, function()
		loading = false
		API.play('rbxassetid://8370988437') --8192419115')
		task.wait(1)

		API.notify{
			Text = '<b>Pause</b> to open mollermethod.\n<i>' .. quotes[math.random(#quotes)] .. '</i>',
			App = 'mollermethod'
		}
	end)

	while loading do
		local particle = Instance.new('ImageLabel', GUI)
		particle.ImageTransparency = 1
		particle.Size = UDim2.new(0, 150, 0, 150)
		particle.Image = ids[math.random(#ids)]
		particle.BackgroundTransparency = 1
		particle.ScaleType = Enum.ScaleType.Fit
		particle.ZIndex = 100
		particle.Position = UDim2.new(math.random(), 0, math.random(), 0)
		Tween:Create(particle, TweenInfo.new(.1), { ImageTransparency = 0 }):Play()
		Tween:Create(
			particle,
			TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.In),
			{
				Position = UDim2.new(),
				Size = UDim2.new()
			}
		):Play()
		Debris:AddItem(particle, 1.5)
		task.wait(1 / 60)
	end
end

-- task.spawn(intro)
intro()

game:GetService('CoreGui').InGameMenu.Overlay.InputCapturer.Visible = false -- lets us click the empty space without closing the menu
local frame = Instance.new('Frame', GUI)
frame.Visible = GuiService.MenuIsOpen
frame.BackgroundTransparency = 1
frame.BorderSizePixel = 0
frame.Position = UDim2.fromOffset(464)
frame.Size = UDim2.new(1, -464, 1, 0)

local title = Instance.new('TextButton', frame)
title.Text = 'mollermethod' .. (remote and ' [serverside]' or '')
title.Font = Enum.Font.GothamBlack
title.TextSize = 24
title.Size = UDim2.new(1, 0, 0, title.TextBounds.Y)

if remote then
	local executor = Instance.new('TextBox', frame)
	executor.Text = ''
	executor.PlaceholderText = '-- So Dank'
	executor.Font = Enum.Font.RobotoMono
	executor.TextSize = 14
	executor.BackgroundTransparency = 1
	executor.TextColor3 = Color3.new(1, 1, 1)
	executor.Size = UDim2.new(1, 0, 1, -title.TextBounds.Y)
	executor.Position = UDim2.fromOffset(0, title.TextBounds.Y)
	executor.TextXAlignment = Enum.TextXAlignment.Left
	executor.TextYAlignment = Enum.TextYAlignment.Top
	executor.TextWrapped = true
	executor.MultiLine = true
	executor.ClearTextOnFocus = false
	title.MouseButton1Click:Connect(function()
		if string.len(executor.Text) > 0 then
			remote:InvokeServer('run', executor.Text)
			executor.Text = ''
		else
			remote:InvokeServer('respawn')
		end
	end)
end

GuiService.MenuClosed:Connect(function()
	frame.Visible = false
end)

GuiService.MenuOpened:Connect(function()
	frame.Visible = true
end)

if game.PlaceId == 537413528 then
	local addev
	addev = workspace.ChildAdded:Connect(function(ch)
	-- copilot generated this, maybe we should do this but with harpoons
	-- Text = '<b>Glue Block Detected</b>\n<i>You are glued to a block, you will be removed in 5 seconds</i>'
		if ch.Name == 'Glue' and ch:WaitForChild('Tag', .3) and ch:FindFirstChild(
			'Tag'
		).Value == Player.Name then
			for _, v in pairs(Player.Character:GetChildren()) do
				if v:IsA('BasePart') then
					for _, j in pairs(v:GetChildren()) do
						if (j:IsA('Snap') or j:IsA('Weld')) and (ch:IsAncestorOf(j.Part1) or ch:IsAncestorOf(
							j.Part0
						)) then
							addev:Disconnect()
							return API.notify{
								App = 'moller sidekick',
								Text = 'mollermethod has a BABFT autofarm.\n<b>Pause</b> Roblox to use it'
							}
						end
					end
				end
			end
		end
	end)
end

--</template>
